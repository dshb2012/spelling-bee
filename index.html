<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Spelling Bee - Writing Practice</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #f8fafc;
}

/* ===== STICKY HEADER ===== */
#header {
  position: sticky;
  top: 0;
  z-index: 1000;
  background: #ffffff;
  box-shadow: 0 4px 10px rgba(0,0,0,0.1);
}

/* TITLE */
#appTitle {
  text-align: center;
  padding: 12px;
  font-size: 22px;
  font-weight: bold;
  color: #2563eb;
  border-bottom: 1px solid #e5e7eb;
}

/* CONTROL PANEL */
#controlPanel {
  display: flex;
  flex-direction: column;
  gap: 10px;
  padding: 12px;
}

/* ROWS */
.control-row {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
}

/* BUTTONS */
button {
  border: none;
  border-radius: 10px;
  padding: 10px 16px;
  font-size: 14px;
  font-weight: bold;
  cursor: pointer;
}

.play { background: #22c55e; color: white; }
.pause { background: #facc15; color: #333; }
.stop { background: #ef4444; color: white; }
.bell { background: #3b82f6; color: white; }

#timerDisplay {
  margin-left: auto;
  background: #f1f5f9;
  padding: 10px 14px;
  border-radius: 10px;
  font-weight: bold;
}

/* TABLE */
table {
  width: 100%;
  border-collapse: collapse;
}

th {
  background: #e0e7ff;
  padding: 10px;
}

td {
  padding: 8px;
  border-bottom: 1px solid #ddd;
}

tr.active {
  background: #fff6cc;
}

.spellBtn {
  background: #6366f1;
  color: white;
  border-radius: 8px;
  padding: 6px 10px;
}
</style>
</head>

<body>

<!-- ===== HEADER ===== -->
<div id="header">
  <div id="appTitle">Spelling Bee ‚Äì Writing Practice</div>

  <div id="controlPanel">
    <!-- TOP ROW -->
    <div class="control-row">
      <button class="play" onclick="playAll()">‚ñ∂ Play All</button>
      <button class="pause" onclick="pauseResume()">‚è∏ Pause / Resume</button>
      <button class="stop" onclick="stopPlay()">‚èπ Stop</button>
    </div>

    <!-- BOTTOM ROW -->
    <div class="control-row">
      Start Row:
      <input type="number" id="startRow" value="1" min="1" style="width:60px;">
      <button class="play" onclick="playFromRow()">‚ñ∂</button>

      <button class="bell" id="bellBtn" onclick="toggleBell()">üîî Bell ON</button>

      <span id="timerDisplay">‚è± 20</span>
    </div>
  </div>
</div>

<input type="file" accept=".csv" onchange="loadCSV(event)" style="margin:10px;">

<table>
<thead>
<tr>
  <th>No.</th>
  <th>Word</th>
  <th>Sentence</th>
  <th>Word</th>
  <th>Spelling</th>
</tr>
</thead>
<tbody id="dataTable"></tbody>
</table>

<script>
let rows = [];
let currentRow = 0;
let playing = false;
let paused = false;
let bellMuted = false;
let timerInterval;
let beepCtx;

/* ===== UTIL ===== */
const wait = ms => new Promise(r => setTimeout(r, ms));

function speak(text) {
  return new Promise(resolve => {
    const u = new SpeechSynthesisUtterance(text);
    u.lang = "en-US";
    u.onend = resolve;
    speechSynthesis.speak(u);
  });
}

/* ===== BELL ===== */
function beep(freq=800, dur=0.15) {
  if (bellMuted) return;
  if (!beepCtx) beepCtx = new (window.AudioContext || window.webkitAudioContext)();
  const osc = beepCtx.createOscillator();
  const gain = beepCtx.createGain();
  osc.frequency.value = freq;
  osc.connect(gain);
  gain.connect(beepCtx.destination);
  osc.start();
  gain.gain.exponentialRampToValueAtTime(0.001, beepCtx.currentTime + dur);
  osc.stop(beepCtx.currentTime + dur);
}

/* ===== CSV ===== */
function loadCSV(e) {
  const reader = new FileReader();
  reader.onload = () => {
    rows = reader.result.trim().split("\n").map(r => r.split(","));
    renderTable();
  };
  reader.readAsText(e.target.files[0]);
}

/* ===== RENDER ===== */
function renderTable() {
  dataTable.innerHTML = "";
  rows.forEach((r,i) => {
    const tr = document.createElement("tr");
    r.forEach(c => {
      const td = document.createElement("td");
      td.textContent = c;
      tr.appendChild(td);
    });
    const td = document.createElement("td");
    const btn = document.createElement("button");
    btn.textContent = "üî§ Spell";
    btn.className = "spellBtn";
    btn.onclick = () => spellingRow(i);
    td.appendChild(btn);
    tr.appendChild(td);
    dataTable.appendChild(tr);
  });
}

/* ===== TIMER ===== */
function startTimer() {
  return new Promise(resolve => {
    let t = 20;
    timerDisplay.textContent = `‚è± ${t}`;
    timerInterval = setInterval(() => {
      if (paused) return;
      t--;
      timerDisplay.textContent = `‚è± ${t}`;
      beep(600 + (20 - t) * 20);
      if (t <= 0) {
        clearInterval(timerInterval);
        resolve();
      }
    }, 1000);
  });
}

/* ===== PLAY ===== */
async function playRow(i) {
  document.querySelectorAll("tr").forEach(r => r.classList.remove("active"));
  document.querySelectorAll("tr")[i+1].classList.add("active");

  await speak(rows[i][1]);
  await wait(500);
  await speak(rows[i][2]);
  await wait(500);
  await speak(rows[i][3]);

  await startTimer();
}

async function playAll() {
  stopPlay();
  playing = true;
  for (; currentRow < rows.length && playing; currentRow++) {
    while (paused) await wait(200);
    await playRow(currentRow);
  }
}

function playFromRow() {
  stopPlay();
  currentRow = Math.max(0, startRow.value - 1);
  playAll();
}

function pauseResume() {
  paused = !paused;
}

function stopPlay() {
  playing = false;
  paused = false;
  speechSynthesis.cancel();
  clearInterval(timerInterval);
}

/* ===== SPELLING ===== */
async function spellingRow(i) {
  const w = rows[i][3];
  if (!w) return;
  await speak(w);
  await wait(400);
  for (let c of w) {
    await speak(c);
    await wait(400);
  }
  await speak(w);
}

/* ===== UI ===== */
function toggleBell() {
  bellMuted = !bellMuted;
  bellBtn.textContent = bellMuted ? "üîï Bell OFF" : "üîî Bell ON";
}
</script>

</body>
</html>
