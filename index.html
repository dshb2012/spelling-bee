<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Reading Class</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  font-family: Arial, sans-serif;
  background: #f4f6f8;
  margin: 0;
  padding-top: 55px;
}

#timerBox {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  background: #d32f2f;
  color: white;
  font-size: 20px;
  font-weight: bold;
  text-align: center;
  padding: 10px;
  z-index: 9999;
}

h2 {
  text-align: center;
  margin-top: 10px;
}

.controls {
  text-align: center;
  margin: 15px;
}

button {
  padding: 10px 18px;
  font-size: 16px;
  margin: 5px;
  border: none;
  border-radius: 6px;
  background: #2196f3;
  color: white;
}

button:disabled {
  background: #aaa;
}

table {
  width: 100%;
  border-collapse: collapse;
  background: white;
}

th, td {
  border: 1px solid #ccc;
  padding: 8px;
}

tr.active {
  background: #d0ebff;
}
</style>
</head>

<body>

<div id="timerBox">
  <span id="timer">Siap</span>
</div>

<h2>Spelling Bee - Writting Practice</h2>

<div class="controls">
  <input type="file" id="csvFile" accept=".csv">
  <br><br>
  <button id="playAll">â–¶ Play Semua</button>
</div>

<table id="dataTable">
  <thead>
    <tr>
      <th>Kata</th>
      <th>Kalimat</th>
      <th>Kata</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
let rows = [];
let isPlaying = false;
let voice = window.speechSynthesis;

document.getElementById("csvFile").addEventListener("change", function(e) {
  const file = e.target.files[0];
  const reader = new FileReader();

  reader.onload = function() {
    const lines = reader.result.split("\n");
    rows = [];
    const tbody = document.querySelector("#dataTable tbody");
    tbody.innerHTML = "";

    lines.forEach(line => {
      const cols = line.split(",");
      if (cols.length >= 3) {
        rows.push(cols);
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${cols[0]}</td><td>${cols[1]}</td><td>${cols[2]}</td>`;
        tbody.appendChild(tr);
      }
    });
  };

  reader.readAsText(file);
});

document.getElementById("playAll").addEventListener("click", async function() {
  if (rows.length === 0) {
    alert("Pilih file CSV terlebih dahulu");
    return;
  }
  isPlaying = true;
  document.getElementById("playAll").disabled = true;
  await playRows();
  document.getElementById("playAll").disabled = false;
});

async function playRows() {
  const trs = document.querySelectorAll("#dataTable tbody tr");

  for (let i = 0; i < rows.length && isPlaying; i++) {
    trs.forEach(tr => tr.classList.remove("active"));
    trs[i].classList.add("active");

    await speak(rows[i][0]);
    await delay(400);

    await speak(rows[i][1]);
    await delay(400);

    await speak(rows[i][2]);

    await countdown(20);
  }

  document.getElementById("timer").textContent = "Selesai";
  isPlaying = false;
}

function speak(text) {
  return new Promise(resolve => {
    const utter = new SpeechSynthesisUtterance(text);
    utter.lang = "en-US";
    utter.onend = resolve;
    voice.speak(utter);
  });
}

function delay(ms) {
  return new Promise(res => setTimeout(res, ms));
}

async function countdown(seconds) {
  for (let i = seconds; i > 0 && isPlaying; i--) {
    document.getElementById("timer").textContent =
      `Baris berikutnya dalam ${i} detik`;
    await delay(1000);
  }
}
</script>

</body>
</html>
